{% extends 'base.html' %}
{% load static %}



{% block content %}
<h1> {{context.title}} </h1>
<hr>
<div class="row">
    <div class="col">
        <h4> Первичные метрические характеристики: </h4>
        <hr>
        <form id="param1">
            {% csrf_token %}
            <div class="col">
                <div class="mb-3">
                    <label class="form-label">Вводимые переменные для расчетов и для обеспечения вывода</label>
                    <input class="form-control" id='P' name="Вводимые переменные" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Весовой коэффициент</label>
                    <input class="form-control" id='PWeight' name="Весовой коэффициент P" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Модифицируемые, или создаваемые внутри программы переменные</label>
                    <input class="form-control" id='M' name="Модифицируемые переменные" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Весовой коэффициент</label>
                    <input class="form-control" id='MWeight' name="Весовой коэффициент M" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Переменные, участвующие в управлении работой программного модуля (управляющие переменные)</label>
                    <input class="form-control" id='C' name="Переменные, уч. в управлении" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Весовой коэффициент</label>
                    <input class="form-control" id='CWeight' name="Весовой коэффициент С" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Не используемые в программе («паразитные») переменные</label>
                    <input class="form-control" id='T' name="Не используемые переменные" onchange="calculate()">
                </div>
                <div class="mb-3">
                    <label class="form-label">Весовой коэффициент</label>
                    <input class="form-control" id='TWeight' name="Весовой коэффициент T" onchange="calculate()">
                </div>
                <hr>
                <div class="row justify-content-md-center">
                    <div class="col">
                        <button class='btn btn-primary' type="submit" style="width: 200px">Сохранить в БД</button>
                    </div>
                    <div class="col">
                        <button class='btn btn-primary' type="button" style="width: 200px" onclick="location.reload();">Очистить форму</button>
                    </div>
                    <div class="col">
                        <button class='btn btn-primary' type="button" style="width: 200px" onclick="get_pdf()">Отчёт</button>
                    </div>
                </div>
                <hr>
            </div>
        </form>
    </div>
    <div class="col">
        <h4> Рассчитанные метрические характеристики: </h4>
        <hr>
        <form id="param2">
            {% csrf_token %}
            <div class="mb-3">
                <label class="form-label">Метрика Чепина</label>
                <input class="form-control" name="Метрика Чепина" id="Q" readonly>
            </div>
        </form>
    </div>
</div>


<script>
    function calculate() {
        console.log('Calculate');

        const P = Number(document.getElementById('P').value);
        const M = Number(document.getElementById('M').value);
        const C = Number(document.getElementById('C').value);
        const T = Number(document.getElementById('T').value);
        const PWeight = Number(document.getElementById('PWeight').value);
        const MWeight = Number(document.getElementById('MWeight').value);
        const CWeight = Number(document.getElementById('CWeight').value);
        const TWeight = Number(document.getElementById('TWeight').value);

        <!--    Словарь    -->
        const Q = PWeight * P + MWeight * M + CWeight * C + TWeight * T;
        document.getElementById('Q').value = Q;

    }

    function get_pdf(){
        data = new FormData(document.getElementById('param1'));
        data2 = new FormData(document.getElementById('param2'));
        for(var pair of data2.entries()){
            data.append(pair[0], pair[1]);
        }
        console.log('data=', data);
        const url = 'http://'+window.location.hostname+':'+window.location.port+'{% url "get_pdf" %}';
        fetch(url,
         { method: 'POST', body: data, credentials: 'same-origin',})
         .then(response=>response.blob())
         .then(data=>{
                const anchorElement = document.createElement('a');
                const url = window.URL.createObjectURL(data);
                anchorElement.href = url;
                anchorElement.download = 'Отчёт метрика Холстеда';
                anchorElement.click();
             });
    }
</script>

{% endblock %}